<!DOCTYPE html>
<html>
<head>
  <title>Askjuan</title>
  <%= stylesheet_link_tag    "global", :media => "all" %>
<%= javascript_include_tag 'jquery-1.7.2' %>
<%= javascript_include_tag 'processing-1.3.6' %>
<%= javascript_include_tag 'suggest.js' %>


        <link rel="stylesheet" href="/pruebas/theme/default/style.css" type="text/css">
        <link rel="stylesheet" href="/pruebas/style.css" type="text/css">
        
        <script src="/pruebas/lib/Firebug/firebug.js"></script>
        <script src="/pruebas/OpenLayers.js"></script>
        <script type="text/javascript">
		
            var map, controls; 
			
            function init(){
                map = new OpenLayers.Map('mapa');
				console.dir(map);
				var layer = new OpenLayers.Layer.OSM( "Simple OSM Map");

                map.addLayers([layer]);
                  map.setCenter( new OpenLayers.LonLat('-666497.4453543', '4493995.6445449'), 4);
            }
            
          
        </script>


  <%= csrf_meta_tags %>
  <script type="text/javascript">
  	var tId,pjs,cnt=0;

 $(document).ready(
 function() {
 	init("mapa_div");
  pjs = Processing.getInstanceById("kenviz");
  console.log(cnt+':'+pjs);
  if (!pjs) tId=setInterval(function() {
    pjs = Processing.getInstanceById("kenviz");
    console.log(cnt+':'+pjs);
    if (pjs){
	clearInterval(tId);
	inicia(pjs);		
	} 
  },500);
});

  function inicia() {
    p = Processing.getInstanceById("kenviz");

    function canvasSupported() {
      var canvas_compatible = false;
      try {
       canvas_compatible = !!(document.createElement('canvas').getContext('2d')); // S60
      } catch(e) {
       canvas_compatible = !!(document.createElement('canvas').getContext); // IE
      }
      return canvas_compatible;
    }

    if (canvasSupported()) {
      
  
  
      var search = $("#fb-suggest");
	  var debugueo=true;
      search.suggest({"type": "/common/topic"})
      .bind("fb-select", function(e, data) {
	  	//console.dir(p.resourceId);
        if (debugueo) {
			p.setR(1);
		}
		else 
			p.setR(data.id);
		 //alert("val:"+p.resourceId);
           p.setup();
      })
      .focus(function(e) {
        if ($(this).val() == $(this).attr('default')) {
          $(this).val("");
        }
        else {
          $(this).select();
        }
        $(this).removeClass('ghost-input');
      })
      .blur(function(e) {
        if (!$(this).val()) {
          $(this).val($(this).attr('default')).addClass('ghost-input');
        }
      });
      
      search.val(search.attr('default')).addClass('ghost-input');

      // init
     // p.init(p.ajax("/javascripts/pjs/physics.pjs")+p.ajax("/javascripts/pjs/value.pjs")+p.ajax("/javascripts/pjs/attribute.pjs")+p.ajax("/javascripts/pjs/resource.pjs")+p.ajax("/javascripts/pjs/node.pjs")+p.ajax("/javascripts/pjs/edge.pjs")+p.ajax("/javascripts/pjs/graph.pjs")+p.ajax("/javascripts/pjs/network.pjs"));
      //initialized = true;
               //p.setR(null);

      $(window).resize(function(){
        p.resize();
      });
    } else {
      $('#browser_not_supported').show();
      $('#explanation').hide();
    }
  }




</script>

</head>
<body>
<canvas id="kenviz" data-processing-sources="/javascripts/pjs/network.pjs 
/javascripts/pjs/physics.pjs 
/javascripts/pjs/value.pjs 
/javascripts/pjs/attribute.pjs 
/javascripts/pjs/resource.pjs 
/javascripts/pjs/edge.pjs 
/javascripts/pjs/node.pjs 
/javascripts/pjs/graph.pjs"></canvas>  
<header >
<section id="title">
	<%=yield :extra%>
</section>
<section id="search">
<input autocomplete="off" default="Search 8 million interconnected topics ..." id="fb-suggest" name="fb-suggest" type="text" class="">
</section>
<br style="clear: both;">
</header>
<section id="content" style="position:relative;">
<%= yield %>
</section>
<section id="mapa" style="z-index: 15; top: 10px; left: 10px; height:100px; width:100px;position: absolute;">
<div id="mapa_div">
	otra
</div>
</section>
<aside>
<div id="explanation">
<!-- askken introduction -->
<span>ASK JUAN </span>
<p>Visual Knowledge Browser based en ASK KEN™</p>

<h2>About</h2>
<p>
ASK KEN™ is sort of a Node-Link diagram that allows to visually navigate through
interconnected topics provided by the
<a href="http://freebase.com">Freebase</a>
Service.
It takes advantage of the latest HTML5 features
by using the canvas element for drawing.
</p>
<h3>Get started</h3>
<p>
Start using the browser by just typing in the name of a topic, as you would do in Wikipedia.
</p>
<h3>Quirks</h3>
<p>
Although it’s basically working, the project has rough edges and is far from being complete. There may be some
unexpected behavior here and there. Also, as the number of nodes increases,
the performance may drop significantly. So please be aware of that.
</p>
<h3>Credits</h3>
<p>
Thanks to
<a href="http://froodee.at/" target="_blank">Samo Korosec</a>
for helping with color and layout.
</p>
</div>
<div id="browser_not_supported">
Your Browser is currently not supported.<br><br>Try one of these:<br>
<a href="http://www.mozilla.com/en-US/firefox/firefox.html">Firefox 3.5</a><br>
<a href="http://www.apple.com/safari/">Safari 4.0</a><br>
<a href="http://www.google.com/chrome/">Chrome</a><br>
</div>
</aside>
<footer>
<div class="left">
Created by
<a href="http://twitter.com/_mql">Michael Aufreiter</a>
at
<a href="http://quasipartikel.at">Quasipartikel</a>
Labs
</div>
<div class="right">
feeded by
<a href="http://freebase.com" target="_blank">Freebase</a>
| Code available at
<a href="http://github.com/michael/askken" target="_blank">Github</a>
</div>
</footer>
</body>
</html>
